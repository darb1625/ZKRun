ZKRun: zk-based Proof-of-Run with RISC Zero

Overview

This project proves (privately) that a runner completed a ≥5 km route under constraints and publishes only minimal public outputs on-chain via a RISC Zero proof.

Components

- Guest (Rust, RISC Zero):
  - Verifies an Ethereum ECDSA signature over SHA-256(blob)
  - Recomputes blob hash
  - Checks GPS timestamp monotonicity, total distance ≥ 5 km, elapsed ≤ X minutes, and per-segment max speed ≤ 12 m/s
  - Outputs journal bytes: [passed (1 byte), elapsed_sec (4 bytes, BE), blob_hash (32 bytes), signer_addr (20 bytes)]

- Solidity Contract:
  - Accepts `blobHash`, `elapsedSec`, `journal`, `seal`
  - Verifies the receipt via RISC Zero verifier contract using an embedded `IMAGE_ID`
  - Parses journal, enforces it matches args and `signer_addr == msg.sender`
  - Emits `RunAccepted(player, blobHash, elapsedSec)` on success

- Client (Node.js/TypeScript):
  - Simulates a GPS trace
  - Builds and signs blob (SHA-256) with Ethereum key (raw secp256k1, no prefix)
  - Encodes input as CBOR, calls Bonsai prover to get receipt
  - Submits proof to the contract

Privacy

- Only `blobHash`, `elapsedSec`, and the ZK receipt (journal+seal) go on-chain.
- Raw GPS, blob contents, signature are private within the proof.

Quick Start

Prerequisites: Rust (nightly recommended), Cargo, Node 18+, pnpm or npm, Foundry or Hardhat, and RISC Zero toolchain. Bonsai account/key if using remote proving.

1) Build guest and obtain IMAGE_ID

```
cd methods/guest
cargo build --release
# After building with RISC Zero toolchain, record the IMAGE_ID printed or generated by the build. Paste it into:
# - contracts/RunVerifier.sol (IMAGE_ID constant)
# - client/.env (METHOD_ID)
```

2) Install and compile contracts

```
cd contracts
pnpm install
pnpm hardhat compile
```

3) Deploy verifier + RunVerifier (local or testnet)

```
# Ensure you have a RISC Zero Groth16 verifier address or deploy one (see @risc0/contracts)
pnpm hardhat run scripts/deploy.ts --network <network>
```

4) Run the client prover + submit

```
cd client
pnpm install
cp .env.example .env  # fill METHOD_ID, RPC_URL, PRIVATE_KEY, CONTRACT_ADDRESS, BONSAI_API_KEY
pnpm ts-node src/index.ts
```

Notes

- Journal layout is fixed and parsed by the contract. Do not change without updating both sides.
- The guest uses fixed-point math (no floating point) and an equirectangular approximation with polynomial cos() for distance; it is suitable for urban-scale runs with small error (<~5m over a few km). Adjust thresholds if needed.
- Signature is raw secp256k1 over SHA-256(blob) with recovery id (v in {27,28} or {0,1}).


# ZKRun
